{
    "ast": null,
    "code": "import { EventEmitter } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"../background-message.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"../settings/settings.component\";\nimport * as i6 from \"../guides/guides.component\";\nconst _c0 = [\"requestModalClose\"];\nconst _c1 = [\"requestModalInfo\"];\nconst _c2 = [\"requestModalYes\"];\nconst _c3 = [\"requestModalNo\"];\nconst _c4 = [\"requestVPInfo\"];\nconst _c5 = [\"requestVPInfoTxT\"];\n\nfunction MainComponent_div_9_button_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 37);\n    i0.ɵɵlistener(\"click\", function MainComponent_div_9_button_15_Template_button_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r12);\n      const request_r10 = restoredCtx.$implicit;\n      const ctx_r11 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r11.selectRequest(request_r10));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const request_r10 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(request_r10.client_id);\n  }\n}\n\nfunction MainComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"div\", 9);\n    i0.ɵɵelement(2, \"img\", 10);\n    i0.ɵɵelementStart(3, \"div\", 11)(4, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function MainComponent_div_9_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.showGuides());\n    });\n    i0.ɵɵtext(5, \"Guides\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function MainComponent_div_9_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.showSettings());\n    });\n    i0.ɵɵtext(7, \"Settings\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function MainComponent_div_9_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.logout());\n    });\n    i0.ɵɵtext(9, \"Logout\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"p\");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"p\", 13);\n    i0.ɵɵtext(13, \"Pending Requests\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 14);\n    i0.ɵɵtemplate(15, MainComponent_div_9_button_15_Template, 2, 1, \"button\", 15);\n    i0.ɵɵelementStart(16, \"div\", 16)(17, \"div\", 17)(18, \"div\", 18)(19, \"div\", 19)(20, \"h5\", 20);\n    i0.ɵɵtext(21, \"Confirm login request\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"button\", 21)(23, \"span\", 22);\n    i0.ɵɵtext(24, \"\\u00D7\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(25, \"div\", 23)(26, \"p\");\n    i0.ɵɵtext(27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(28, \"p\", null, 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"div\", 25, 26)(32, \"p\", 27);\n    i0.ɵɵtext(33, \"vp_token data :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"textarea\", 28, 29);\n    i0.ɵɵlistener(\"ngModelChange\", function MainComponent_div_9_Template_textarea_ngModelChange_34_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.vpTextAreaValue = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(36, \"div\", 30)(37, \"button\", 31, 32);\n    i0.ɵɵlistener(\"click\", function MainComponent_div_9_Template_button_click_37_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.processRequest(true));\n    });\n    i0.ɵɵtext(39, \"Yes\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"button\", 33, 34);\n    i0.ɵɵlistener(\"click\", function MainComponent_div_9_Template_button_click_40_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.processRequest(false));\n    });\n    i0.ɵɵtext(42, \"No\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"button\", 35, 36);\n    i0.ɵɵtext(45, \"Cancel\");\n    i0.ɵɵelementEnd()()()()()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(11);\n    i0.ɵɵtextInterpolate(ctx_r0.currentDID);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.currentRequests);\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate1(\"Confirm login to \", ctx_r0.selectedRequestClientID, \" \");\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.vpTextAreaValue);\n  }\n}\n\nfunction MainComponent_app_guides_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-guides\", 38);\n    i0.ɵɵlistener(\"clickedBack\", function MainComponent_app_guides_10_Template_app_guides_clickedBack_0_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.showMainContent());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction MainComponent_app_settings_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-settings\", 38);\n    i0.ɵɵlistener(\"clickedBack\", function MainComponent_app_settings_11_Template_app_settings_clickedBack_0_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r22 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r22.showMainContent());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let MainComponent = /*#__PURE__*/(() => {\n  class MainComponent {\n    constructor(changeDetector, toastrService, messageService) {\n      this.changeDetector = changeDetector;\n      this.toastrService = toastrService;\n      this.messageService = messageService;\n      this.title = 'did-siop-ext';\n      this.loggedOut = new EventEmitter();\n      this.displayMainContent = true;\n      this.displaySettings = false;\n      this.displayGuides = false;\n      this.loadIdentity();\n      this.loadRequests();\n    }\n\n    logout() {\n      this.messageService.sendMessage({\n        task: 6\n        /* TASKS.LOGOUT */\n\n      }, response => {\n        if (response.result) {\n          this.loggedOut.emit(true);\n        }\n      });\n    }\n\n    showMainContent() {\n      this.displayMainContent = true;\n      this.displayGuides = false;\n      this.displaySettings = false;\n      this.loadIdentity();\n      this.changeDetector.detectChanges();\n    }\n\n    showGuides() {\n      this.displayGuides = true;\n      this.displayMainContent = false;\n      this.displaySettings = false;\n      this.changeDetector.detectChanges();\n    }\n\n    showSettings() {\n      this.displaySettings = true;\n      this.displayGuides = false;\n      this.displayMainContent = false;\n      this.changeDetector.detectChanges();\n    }\n\n    selectRequest(request) {\n      var _a, _b;\n\n      this.requestModalInfo.nativeElement.innerHTML = '';\n      this.requestModalInfo.nativeElement.classList.remove('error');\n      this.requestModalInfo.nativeElement.classList.remove('waiting');\n      this.requestModalYes.nativeElement.disabled = false;\n      this.requestModalNo.nativeElement.disabled = false;\n      this.requestModalClose.nativeElement.disabled = false;\n      this.selectedRequest = request;\n      this.selectedRequestClientID = this.selectedRequest.client_id;\n\n      if (request.request) {\n        try {\n          let decode_request = this.parseJwt(request.request);\n\n          if ((_a = decode_request.claims) === null || _a === void 0 ? void 0 : _a.vp_token) {\n            //set current vp data to textarea\n            this.vpInfo = (_b = decode_request.claims) === null || _b === void 0 ? void 0 : _b.vp_token;\n            this.requestVPInfo.nativeElement.classList.add('active');\n          } else {\n            //empty current vp data to textarea\n            this.vpInfo = null;\n            this.requestVPInfo.nativeElement.classList.remove('active');\n          }\n        } catch (error) {\n          //empty current vp data to textarea\n          this.vpInfo = null;\n          this.requestVPInfoTxT.nativeElement.value = this.vpTextAreaValue;\n          this.requestVPInfo.nativeElement.classList.remove('active');\n        }\n      }\n\n      this.changeDetector.detectChanges();\n    }\n\n    get vpTextAreaValue() {\n      return JSON.stringify(this.vpInfo, null, 2);\n    }\n\n    set vpTextAreaValue(v) {\n      try {\n        this.vpInfo = JSON.parse(v);\n      } catch (e) {\n        console.log(\"error occored while you were typing the JSON\");\n      }\n    }\n\n    parseJwt(token) {\n      return JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString());\n    }\n\n    processRequest(confirmation) {\n      this.requestModalYes.nativeElement.disabled = true;\n      this.requestModalNo.nativeElement.disabled = true;\n      this.requestModalClose.nativeElement.disabled = false;\n      this.requestModalInfo.nativeElement.classList.add('waiting');\n      this.requestModalInfo.nativeElement.innerHTML = 'Processing request. Please wait';\n      this.messageService.sendMessage({\n        task: 3\n        /* TASKS.PROCESS_REQUEST */\n        ,\n        did_siop_index: this.selectedRequest.index,\n        confirmation: confirmation,\n        vp_token: this.vpInfo\n      }, response => {\n        if (response.result) {\n          this.loadRequests();\n          this.requestModalClose.nativeElement.click();\n        } else if (response.err) {\n          console.log(\"ERROR returned from background processRequest\");\n          this.requestModalInfo.nativeElement.classList.remove('waiting');\n          this.requestModalInfo.nativeElement.classList.add('error');\n          this.requestModalInfo.nativeElement.innerHTML = response.err;\n          this.requestModalClose.nativeElement.disabled = false;\n        } else {\n          console.log(\"Error returned from background - response.result & response.err are null\");\n        }\n      });\n    }\n\n    loadIdentity() {\n      this.messageService.sendMessage({\n        task: 10\n        /* TASKS.GET_IDENTITY */\n\n      }, response => {\n        if (response.did) {\n          this.currentDID = response.did;\n        } else {\n          this.currentDID = 'No DID provided';\n        }\n\n        this.changeDetector.detectChanges();\n      });\n    }\n\n    loadRequests() {\n      this.messageService.sendMessage({\n        task: 11\n        /* TASKS.GET_REQUESTS */\n\n      }, response => {\n        if (response.didSiopRequests) {\n          this.currentRequests = response.didSiopRequests;\n        } else {\n          this.currentRequests = [];\n        }\n\n        this.changeDetector.detectChanges();\n      });\n    }\n\n  }\n\n  MainComponent.ɵfac = function MainComponent_Factory(t) {\n    return new (t || MainComponent)(i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.ToastrService), i0.ɵɵdirectiveInject(i2.BackgroundMessageService));\n  };\n\n  MainComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MainComponent,\n    selectors: [[\"app-main\"]],\n    viewQuery: function MainComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n        i0.ɵɵviewQuery(_c2, 5);\n        i0.ɵɵviewQuery(_c3, 5);\n        i0.ɵɵviewQuery(_c4, 5);\n        i0.ɵɵviewQuery(_c5, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.requestModalClose = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.requestModalInfo = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.requestModalYes = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.requestModalNo = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.requestVPInfo = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.requestVPInfoTxT = _t.first);\n      }\n    },\n    outputs: {\n      loggedOut: \"loggedOut\"\n    },\n    decls: 12,\n    vars: 3,\n    consts: [[1, \"d-flex\", \"flex-column\", \"align-items-center\", \"justify-content-center\", \"mx-auto\", \"main-wrapper\"], [1, \"header\"], [1, \"d-flex\", \"flex-column\", \"align-items-center\", \"header-top\"], [\"src\", \"assets/logo.svg\", \"alt\", \"did-siop logo\", 1, \"did-siop-logo\"], [1, \"title-description\"], [1, \"separator\"], [\"class\", \"d-flex flex-column align-items-center main-content\", 4, \"ngIf\"], [3, \"clickedBack\", 4, \"ngIf\"], [1, \"d-flex\", \"flex-column\", \"align-items-center\", \"main-content\"], [1, \"d-flex\", \"flex-column\", \"align-items-center\", \"identity\"], [\"src\", \"assets/avatar.png\", \"alt\", \"identity avatar\"], [1, \"d-flex\", \"justify-content-center\", \"navigation\"], [1, \"btn\", \"btn-link\", \"flex-fill\", 3, \"click\"], [1, \"requests-title\"], [1, \"d-flex\", \"flex-column\", \"align-items-center\", \"container-fluid\", \"requests\"], [\"class\", \"btn btn-success btn-request\", \"data-toggle\", \"modal\", \"data-target\", \"#requestModal\", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"id\", \"requestModal\", \"tabindex\", \"-1\", \"role\", \"dialog\", \"aria-labelledby\", \"requestModalLabel\", \"aria-hidden\", \"true\", 1, \"modal\"], [\"role\", \"document\", 1, \"modal-dialog\"], [1, \"modal-content\"], [1, \"modal-header\"], [\"id\", \"requestModalLabel\", 1, \"modal-title\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"close\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\"], [\"requestModalInfo\", \"\"], [1, \"text-wrap\"], [\"requestVPInfo\", \"\"], [1, \"title\"], [\"cols\", \"30\", \"rows\", \"10\", 3, \"ngModel\", \"ngModelChange\"], [\"requestVPInfoTxT\", \"\"], [1, \"modal-footer\", \"d-flex\", \"justify-content-start\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"btn-ok\", 3, \"click\"], [\"requestModalYes\", \"\"], [\"type\", \"button\", 1, \"btn\", \"btn-link\", \"btn-cancel\", 3, \"click\"], [\"requestModalNo\", \"\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-link\", \"ml-auto\", \"btn-cancel\"], [\"requestModalClose\", \"\"], [\"data-toggle\", \"modal\", \"data-target\", \"#requestModal\", 1, \"btn\", \"btn-success\", \"btn-request\", 3, \"click\"], [3, \"clickedBack\"]],\n    template: function MainComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2);\n        i0.ɵɵelement(3, \"img\", 3);\n        i0.ɵɵelementStart(4, \"p\", 4);\n        i0.ɵɵtext(5, \"Self-issued OpenIDConnect Provider based on \");\n        i0.ɵɵelement(6, \"br\");\n        i0.ɵɵtext(7, \" Decentralized Identities\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(8, \"div\", 5);\n        i0.ɵɵtemplate(9, MainComponent_div_9_Template, 46, 4, \"div\", 6);\n        i0.ɵɵtemplate(10, MainComponent_app_guides_10_Template, 1, 0, \"app-guides\", 7);\n        i0.ɵɵtemplate(11, MainComponent_app_settings_11_Template, 1, 0, \"app-settings\", 7);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.displayMainContent);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.displayGuides);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.displaySettings);\n      }\n    },\n    dependencies: [i3.NgForOf, i3.NgIf, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel, i5.SettingsComponent, i6.GuidesComponent],\n    styles: [\".main-wrapper[_ngcontent-%COMP%]{width:100%;max-height:100%;overflow:hidden}.header[_ngcontent-%COMP%]{margin-bottom:4px}.header-top[_ngcontent-%COMP%]{width:100%;padding-top:12px}.header-top[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-bottom:5px}.header-top[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;margin-bottom:10px}.did-siop-logo[_ngcontent-%COMP%]{height:32px}.separator[_ngcontent-%COMP%]{width:100%;height:1px;border-bottom:1px solid #24c1b6;margin-bottom:10px}.navigation[_ngcontent-%COMP%]{margin-bottom:4px;width:150px}.navigation[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#24c1b6;font-size:12px;padding-right:0;padding-left:0}.main-content[_ngcontent-%COMP%]{height:500px}.identity[_ngcontent-%COMP%]{margin-bottom:20px}.identity[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:110px;height:100px}.identity[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;background-color:#f0f0f0;word-break:break-all;width:300px;margin-bottom:0}.requests[_ngcontent-%COMP%]{width:300px;height:235px;padding-top:10px;overflow-y:scroll;background-color:#f0f0f0;-ms-overflow-style:none}.requests[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.btn-request[_ngcontent-%COMP%]{width:100%;background-color:#24c1b6;margin-bottom:10px}.requests-title[_ngcontent-%COMP%]{margin-bottom:4px;color:#24c1b6;width:130px;text-align:center}.btn-ok[_ngcontent-%COMP%]{background-color:#24c1b6;border:1px solid #24c1b6;border-radius:40px;min-width:100px}.btn-cancel[_ngcontent-%COMP%]{color:#24c1b6}.btn-link[_ngcontent-%COMP%]:active:focus{background-color:transparent}.btn-link[_ngcontent-%COMP%]:focus{outline:none!important;box-shadow:none}.error[_ngcontent-%COMP%]{color:red}.waiting[_ngcontent-%COMP%]{color:#24c1b6}.text-wrap[_ngcontent-%COMP%]{display:none;flex-direction:column;gap:5px;width:100%;padding:10px 20px}.text-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:500}.text-wrap.active[_ngcontent-%COMP%]{display:flex}.text-wrap[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%}\"]\n  });\n  return MainComponent;\n})();",
    "map": null,
    "metadata": {},
    "sourceType": "module"
}
